var rss = require("./");
var http = require("http");
var https = require("https");
var urlUtil = require("url");
var zlib = require("zlib");

var url = "https://www.raspberrypi.org/feed/";
var callback = console.log;
var feed = new rss({ resume_saxerror: false });

            var request;
            if (urlUtil.parse(url).protocol == 'https:')
                request = https.get(url);
            else
                request = http.get(url);

            request.on('response', function (res)
            {
                var encoding = res.headers['content-encoding']
                console.log(encoding);
                if (encoding == 'gzip')
                {
                    res.pipe(zlib.createGunzip()).pipe(feed)
                } else if (encoding == 'deflate')
                {
                    res.pipe(zlib.createInflate()).pipe(feed)
                } else
                {
                    res.pipe(feed)
                }
            });

            var articles = [];
            feed.on('data', function (item)
            {
               articles.push(item); //my item handling
            });
            feed.on('error', function (error)
            {
                console.log(error);
                callback(500, error);
            })
            feed.on('end', function ()
            {
                console.log('end');
                callback(articles);
            });
